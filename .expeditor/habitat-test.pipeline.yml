---
expeditor:
  defaults:
    buildkite:
      timeout_in_minutes: 60
      retry:
        automatic:
          limit: 1

steps:

- label: ":linux: Validate Linux"
  commands:
    - ./.expeditor/scripts/test-script.sh
  expeditor:
    executor:
      linux:
        privileged: true
        single-use: true

# - label: ":windows: Validate Habitat Builds of Chef Infra"
#   commands:
#     - .expeditor/scripts/habitat-test.ps1 -WindowsArtifact chef/chef-infra-client/19.1.46/20250626201805
#   expeditor:
#     executor:
#       windows:
#         privileged: true
#         single-use: true
#         shell: ["powershell", "-Command"]

# Wait for the package testing to succeed before promoting whatever was tested.
# - wait

# - label: ":habicat: Promoting packages to the current channel."
#   commands:
#     - hab pkg promote chef/chef-infra-client/19.1.46/20250626201151 current x86_64-linux
#     - hab pkg promote chef/chef-infra-client/19.1.46/20250626201805 current x86_64-windows
#   expeditor:
#     executor:
#       docker:
#         environment:
#           - HAB_AUTH_TOKEN
