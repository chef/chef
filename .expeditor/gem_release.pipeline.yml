expeditor:
  defaults:
    buildkite:
      timeout_in_minutes: 45

steps:

  - label: ":linux: push gem to artifactory"
    commands:
      - .expeditor/scripts/gem_push_artifactory.sh
    expeditor:
      executor:
        docker:
          privileged: true
          propagate-environment: true
          environment:
            - ARTIFACTORY_API_KEY
            - HAB_AUTH_TOKEN
  # - label: ":windows: push gem to artifactory"
  #   commands:
  #     - .expeditor/scripts/gem_push_artifactory.ps1
  #   agents:
  #     queue: default-windows-2019-privileged
  #   expeditor:
  #     executor:
  #       docker:
  #       windows:
  #         privileged: true
  #         single-use: true
  #         propagate-environment: true
  #         environment:
  #           - ARTIFACTORY_API_KEY
  #           - HAB_AUTH_TOKEN
  - label: ":windows: push gem to artifactory"
    retry:
      automatic:
        limit: 1
    agents:
      queue: default-windows-2019-privileged
    plugins:
    - docker#v3.5.0:
        image: chefes/omnibus-toolchain-windows-2019:3.0.39
        shell:
        - powershell
        - "-Command"
        environment:
          - ARTIFACTORY_API_KEY
          - ARTIFACTORY_LITA_PASSWORD
          - HAB_AUTH_TOKEN
        propagate-environment: true
    commands:
    - ".expeditor/scripts/gem_push_artifactory.ps1"
    timeout_in_minutes: 120
