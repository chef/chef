---
expeditor:
  defaults:
    buildkite:
      retry:
        automatic:
          limit: 1
      timeout_in_minutes: 60

steps:
  - commands:
      - RBENV_DIR="$(rbenv root 2>/dev/null || echo "$HOME/.rbenv")"
      - echo "Using rbenv from: $RBENV_DIR"
      - export PATH="$RBENV_DIR/bin:$RBENV_DIR/shims:$PATH"
      - eval "$(rbenv init - bash)"
      - which ruby
      - ruby -v
      - which buildkite-agent
      - chmod +x .buildkite/validate-adhoc.rb
      - ruby .buildkite/validate-adhoc.rb | "$(command -v buildkite-agent)" pipeline upload
    label: ":pipeline: Upload"
