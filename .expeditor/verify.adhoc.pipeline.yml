
---
expeditor:
  defaults:
    buildkite:
      retry:
        automatic:
          limit: 1
      timeout_in_minutes: 60

steps:
  - label: ":pipeline: Upload"
    commands:
      - curl -sSL https://cache.ruby-lang.org/pub/ruby/3.4/ruby-3.4.2.tar.xz | tar -xJ -C /tmp
      - cd /tmp/ruby-3.4.2
      - ./configure --prefix=/tmp/ruby-3.4.2-install
      - make -j"$(nproc)"
      - make install
      - /tmp/ruby-3.4.2-install/bin/ruby -v
      - cd ../.. # go back to repo root
      - pwd # check current directory
      - chmod +x .buildkite/validate-adhoc.rb
      - /tmp/ruby-3.4.2-install/bin/ruby .buildkite/validate-adhoc.rb | buildkite-agent pipeline upload
