---
expeditor:
  defaults:
    buildkite:
      retry:
        automatic:
          limit: 1
      timeout_in_minutes: 60

steps:
  - label: ":ruby: Validate adhoc"
    commands:
      # Download & extract Ruby 3.4.2
      - curl -sSL https://cache.ruby-lang.org/pub/ruby/3.4/ruby-3.4.2.tar.xz | tar -xJ -C /tmp

      # Build Ruby â€” optimized for speed
      - cd /tmp/ruby-3.4.2
      - ./configure --prefix=/tmp/ruby-3.4.2
      - make -j"$(nproc)" && make install

      # Confirm Ruby installation
      - /tmp/ruby-3.4.2/bin/ruby -v

      # Run your script
      - chmod +x .buildkite/validate-adhoc.rb
      - /tmp/ruby-3.4.2/bin/ruby .buildkite/validate-adhoc.rb | buildkite-agent pipeline upload
