sudo bash -c '

if [ -f /etc/redhat-release ]; then
	echo "CentOS Distribution.  Continuing Bootstrapping Process."
    LINUX_DISTRO="centos"
elif [ -f /etc/issue ]; then
	echo "Ubuntu Distribution.  Continuing Bootstrapping Process."
    LINUX_DISTRO="ubuntu"
else 
    echo "Unsupported linux distribution.  Submit your patch!  http://github.com/BlueBoxGroup/ChefBootstrapScripts"
    exit 2
fi

if [ $LINUX_DISTRO="centos" ]; then
  yum -y git
elif [ $LINUX_DISTRO="ubuntu" ]; then
  apt-get update
  apt-get install -y git
end

cd /tmp && git checkout #{bootstrap_script}
cd ChefBootstrapScripts
bash script/bootstrap.sh

(
cat <<'EOP'
#{IO.read(Chef::Config[:validation_key])}
EOP
) > /etc/chef/validation.pem

(
cat <<'EOP'
log_level :info
log_location STDOUT
chef_server_url "#{Chef::Config[:chef_server_url]}"
validation_client_name "#{Chef::Config[:validation_client_name]}"
EOP
) > /etc/chef/client.rb

(
cat <<'EOP'
#{{ "run_list" => @name_args[1..-1] }.to_json}
EOP
) > /etc/chef/first-boot.json

# Obtain chef-client path and execute first run.
CHEF_CLIENT=`which chef-client`
$CHEF_CLIENT -j /etc/chef/first-boot.json
'